const e=[[[1,1],[1,1]],[[1,0,0],[1,1,1]],[[0,1,0],[1,1,1]],[[1,1,1]]],t={moveLeft:e=>{e.x--},moveRight:e=>{e.x++},moveDown:e=>{e.y++},rotateShape:e=>{let t=[];for(let l=0;l<e.type[0].length;++l){t[l]=[];for(let r=0;r<e.type.length;++r)t[l][r]=e.type[e.type.length-1-r][l]}e.type=t}},l={BLOCK_ACTION:1,CREATE_SHAPE:2,END_THE_GAME:3},r=(e,t)=>{let l=l=>{for(let r of Object.keys(e))if(l.code===r){t(e[r]);break}};return document.addEventListener("keydown",l),()=>{document.removeEventListener("keydown",l)}},o=(o,n,f,y,h)=>{let d=["#6fa8dc","#f6b26b"],i=o.length,u=[],a=[],g=()=>{n(u)},c=t=>{let l=Math.floor(Math.random()*e.length),r={x:0,y:0,type:e[l],color:"#111"};r.x=Math.floor(h.worldWidth/i/2*(2*t+1)),r.y=-r.type.length,r.color=d[t%d.length],u[t].unshift(r),g()},p=(e,t)=>{let r=u[e][0],o=Object.create(r);t(o);for(let t=0;t<y.length;++t){let n=(0,y[t])(o,r,u);if(n===l.BLOCK_ACTION)return;if(n===l.CREATE_SHAPE)return void c(e);n===l.END_THE_GAME&&(alert("GAME OVER!"),E())}t(r),g()},w=f(()=>{for(let e=0;e<u.length;++e)p(e,t.moveDown)}),E=()=>{w(),a.forEach(e=>e())};for(let e=0;e<i;++e)u[e]=[],c(e);for(let e=0;e<i;++e){let t=o[e],l=t=>p(e,t);a[e]=r(t,l)}return E},n=(e,t)=>{let l=t.worldWidth*t.worldScale,r=t.worldHeight*t.worldScale;e.width=l,e.height=r;let o=e.getContext("2d"),n=(e,l,r)=>{o.fillStyle=r,o.strokeStyle="#000",o.fillRect(e*t.worldScale,l*t.worldScale,t.worldScale,t.worldScale),o.strokeRect(e*t.worldScale,l*t.worldScale,t.worldScale,t.worldScale)},f=e=>{o.save(),o.translate(e.x*t.worldScale,e.y*t.worldScale);for(let t=0;t<e.type.length;++t){let l=e.type[t];for(let r=0;r<l.length;++r)l[r]&&n(r,t,e.color)}o.restore()};return e=>{o.clearRect(0,0,l,r);for(let t=0;t<e.length;++t){let l=e[t];for(let e=0;e<l.length;++e)f(l[e])}}},f=e=>t=>{let l=!0,r=()=>{l&&(t(),setTimeout(r,e))};return setTimeout(r,e),()=>{l=!1}},y=e=>{let t=(e,t)=>!(e.x>t.x+t.type[0].length)&&!(e.x+e.type[0].length<t.x)&&!(e.y>t.y+t.type.length)&&!(e.y+e.type.length<t.y),r=(e,t,l,r)=>{if(!e.type[t][l])return!1;let o=t+e.y-r.y,n=l+e.x-r.x;return!!r.type[o]&&!!r.type[o][n]},o=function*(e,t){for(let l=0;l<t.length;++l){let r=t[l];for(let t=0;t<r.length;++t){let l=r[t];l!==e&&(yield[l,0===t])}}};return[(e,n,f)=>{if(e.type===n.type&&e.x>=n.x)return null;if(e.x<0)return l.BLOCK_ACTION;for(let[y]of o(n,f))if(t(e,y)){for(let t=0;t<e.type.length;++t)if(r(e,t,0,y))return l.BLOCK_ACTION}return null},(n,f,y)=>{if(n.type===f.type&&n.x<=f.x)return null;if(n.x+n.type[0].length>e.worldWidth)return l.BLOCK_ACTION;for(let[e]of o(f,y)){if(!t(n,e))continue;let o=n.type[0].length-1;for(let t=0;t<n.type.length;++t)if(r(n,t,o,e))return l.BLOCK_ACTION}return null},(n,f,y)=>{if(n.type===f.type&&n.y<=f.y)return null;if(n.y+n.type.length>e.worldHeight)return l.CREATE_SHAPE;for(let[e,h]of o(f,y)){if(!t(n,e))continue;let o=n.type.length-1;for(let t=0;t<n.type[0].length;++t)if(r(n,o,t,e)){if(n.y<=0)return l.END_THE_GAME;if(h)return l.BLOCK_ACTION;return l.CREATE_SHAPE}}return null}]};document.addEventListener("DOMContentLoaded",()=>{let e=[{KeyW:t.rotateShape,KeyA:t.moveLeft,KeyS:t.moveDown,KeyD:t.moveRight},{ArrowUp:t.rotateShape,ArrowLeft:t.moveLeft,ArrowDown:t.moveDown,ArrowRight:t.moveRight}],l={worldWidth:32,worldHeight:16,worldScale:25},r=n(document.getElementById("game-canvas"),l);o(e,r,f(500),y(l),l)});
//# sourceMappingURL=embed-poc.1791db91.js.map
